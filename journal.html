<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tulisan — Romli Nur Hidayat</title>
    <meta name="description" content="Kumpulan tulisan Romli Nur Hidayat tentang UMKM, koperasi, pengembangan usaha, dan hal-hal yang ia temui di lapangan.">

    <meta property="og:title" content="Tulisan — Romli Nur Hidayat">
    <meta property="og:description" content="Kumpulan catatan dan pemikiran tentang UMKM, koperasi, dan pengembangan usaha.">
    <meta property="og:image" content="https://romli.pages.dev/profile.jpg">

    <link rel="icon" href="profile.jpg" type="image/jpeg">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="header-inner">
            <div class="header-brand">
                <img src="profile.jpg" alt="Romli" onerror="this.src='https://via.placeholder.com/36'">
                <span>Romli Nur Hidayat</span>
            </div>
            <nav class="header-nav">
                <a href="index.html">← Beranda</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <section class="hero" style="padding-bottom: 24px;">
            <h1 class="hero-name" style="font-size:1.5rem;">Tulisan</h1>
            <p style="color:var(--text-sub);font-size:0.9rem;margin-top:8px;">Catatan dari lapangan, pemikiran, dan hal-hal yang terasa perlu dibagikan.</p>
        </section>

        <div id="filter-bar" class="filter-container">
            <button class="filter-btn active" onclick="filterBy('all')">Semua</button>
        </div>

        <div id="journal-list">
            <div class="loading-state">
                <div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div>
                <span>Memuat tulisan...</span>
            </div>
        </div>

        <div class="pagination">
            <button id="prevBtn" class="page-btn" onclick="changePage(-1)" disabled>← Sebelumnya</button>
            <span id="pageInfo" style="font-size:0.78rem; color:var(--text-muted);">Halaman 1</span>
            <button id="nextBtn" class="page-btn" onclick="changePage(1)">Berikutnya →</button>
        </div>
    </div>

    <footer>
        <div class="footer-inner">
            <div>
                <div class="footer-brand">Romli Nur Hidayat</div>
                <div class="footer-sub">Konsultan UMKM · Yogyakarta · &copy; 2026</div>
            </div>
            <div class="footer-links">
                <a href="index.html">Beranda</a>
                <a href="https://wa.me/6282137652772" target="_blank" rel="noopener">WhatsApp</a>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/6282137652772?text=Halo%20Romli%2C%20saya%20baru%20baca%20romli.pages.dev%20dan%20ingin%20ngobrol%20tentang%20usaha%20saya." class="floating-wa" target="_blank" rel="noopener" title="Chat WhatsApp">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
    </a>

    <script data-goatcounter="https://romli.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

    <script>
        const CONFIG = { user: "romli", repo: "romli-site", perPage: 7 };
        let all = [], filtered = [], currentPage = 1;

        const months = ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Ags','Sep','Okt','Nov','Des'];

        function formatDate(filename) {
            const parts = filename.split('-');
            if (parts.length < 3) return '';
            const [y, m, d] = parts;
            return `${parseInt(d)} ${months[parseInt(m)-1]} ${y}`;
        }

        function getTitleFromFilename(filename) {
            const withoutExt = filename.replace('.md', '');
            const parts = withoutExt.split('-');
            if (parts.length <= 4) return withoutExt;
            return parts.slice(4).join(' ');
        }

        function getCategoryFromFilename(filename) {
            const parts = filename.replace('.md','').split('-');
            return parts[3] || 'catatan';
        }

        async function init() {
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/blog`);
                if (!res.ok) throw new Error('GitHub API error');
                all = (await res.json()).filter(f => f.name.endsWith('.md')).reverse();

                // Build category filter buttons
                const cats = new Set();
                all.forEach(f => {
                    const cat = getCategoryFromFilename(f.name);
                    if (cat) cats.add(cat.toLowerCase());
                });

                const fb = document.getElementById('filter-bar');
                [...cats].sort().forEach(c => {
                    const btn = document.createElement('button');
                    btn.className = 'filter-btn';
                    btn.textContent = c.charAt(0).toUpperCase() + c.slice(1);
                    btn.onclick = () => filterBy(c);
                    fb.appendChild(btn);
                });

                filterBy('all');
            } catch (err) {
                document.getElementById('journal-list').innerHTML =
                    '<p style="color:var(--text-muted);font-size:0.88rem;padding:20px 0;">Tidak dapat memuat tulisan saat ini. Coba muat ulang halaman.</p>';
            }
        }

        function filterBy(c) {
            currentPage = 1;
            document.querySelectorAll('.filter-btn').forEach(b => {
                const label = b.textContent.toLowerCase();
                b.classList.toggle('active', label === c || (c === 'all' && label === 'semua'));
            });
            filtered = c === 'all' ? all : all.filter(f => getCategoryFromFilename(f.name).toLowerCase() === c);
            render();
        }

        function render() {
            const list = document.getElementById('journal-list');
            const start = (currentPage - 1) * CONFIG.perPage;
            const slice = filtered.slice(start, start + CONFIG.perPage);

            list.innerHTML = '';

            if (slice.length === 0) {
                list.innerHTML = '<p style="color:var(--text-muted);font-size:0.88rem;padding:20px 0;">Belum ada tulisan di kategori ini.</p>';
            } else {
                slice.forEach(f => {
                    const category = getCategoryFromFilename(f.name);
                    const title = getTitleFromFilename(f.name);
                    const date = formatDate(f.name);

                    list.innerHTML += `
                        <a href="post.html?file=${f.name}" class="blog-item" style="display:flex;flex-direction:column;gap:6px;color:inherit;text-decoration:none;">
                            <div class="blog-meta">
                                <span class="blog-category">${category}</span>
                                ${date ? `<span class="blog-date">${date}</span>` : ''}
                            </div>
                            <h3>${title}</h3>
                            <span class="blog-read">Baca →</span>
                        </a>`;
                });
            }

            const totalPages = Math.ceil(filtered.length / CONFIG.perPage);
            document.getElementById('pageInfo').textContent = `Halaman ${currentPage} dari ${totalPages || 1}`;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = start + CONFIG.perPage >= filtered.length;
        }

        function changePage(s) {
            currentPage += s;
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        init();
    </script>
</body>
</html>
