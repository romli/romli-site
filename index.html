<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Romli - Personal Site</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

    <div class="container">
        <header>
            <h1>Romli</h1>
            <p class="subtitle">Digital Enthusiast & Strategist</p>
        </header>

        <section id="about">
            <h2>Tentang</h2>
            <div id="profile-content" class="card">Memuat profil...</div>
        </section>

        <section id="now">
            <h2>/now</h2>
            <div id="portfolio-list" class="grid">
                <p>Memuat status terbaru...</p>
            </div>
        </section>

        <section id="journal">
            <h2>Journal</h2>
            <div id="blog-list" class="grid">
                <p>Memuat tulisan...</p>
            </div>
            <div id="more-blog" style="margin-top:20px; text-align:center; display:none;">
                <a href="https://github.com/romli/romli-site/tree/main/blog" target="_blank" style="text-decoration:none; color:gray; font-size:0.9rem;">Lihat Arsip Lainnya di GitHub →</a>
            </div>
        </section>
    </div>

    <footer>
        <p>&copy; 2026 Romli Site • Managed via Mobile</p>
    </footer>

    <script>
        const CONFIG = {
            user: "romli", 
            repo: "romli-site",
            sheetUrl: "https://docs.google.com/spreadsheets/d/1E2sWBE7Vh38L-Y4c2Q0UJTMExFpu2CKkWht21LcRKdk/gviz/tq?tqx=out:csv"
        };

        async function loadProfile() {
            try {
                const res = await fetch(`https://raw.githubusercontent.com/${CONFIG.user}/${CONFIG.repo}/main/profile.md`);
                const text = await res.text();
                document.getElementById('profile-content').innerHTML = marked.parse(text);
            } catch (e) { console.error("Gagal muat profil"); }
        }

        async function loadBlog() {
            const list = document.getElementById('blog-list');
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/blog`);
                const files = await res.json();
                const mdFiles = files.filter(f => f.name.endsWith('.md')).reverse();
                const limitedFiles = mdFiles.slice(0, 3);
                
                list.innerHTML = '';
                limitedFiles.forEach(file => {
                    const judul = file.name.replace(/-/g, ' ').replace('.md', '').substring(11);
                    list.innerHTML += `
                        <div class="card">
                            <span style="font-size:0.8rem;color:gray">${file.name.substring(0,10)}</span>
                            <h3 style="margin:10px 0">${judul}</h3>
                            <a href="post.html?file=${file.name}" style="text-decoration:none;color:black;font-weight:600;">Baca Tulisan →</a>
                        </div>`;
                });

                if (mdFiles.length > 3) {
                    document.getElementById('more-blog').style.display = 'block';
                }
            } catch (e) { list.innerHTML = "<p>Belum ada tulisan blog.</p>"; }
        }

        async function loadNow() {
            const list = document.getElementById('portfolio-list');
            try {
                const res = await fetch(CONFIG.sheetUrl);
                const data = await res.text();
                const rows = data.split('\n').slice(1); 
                
                // BATASAN: Sekarang menampilkan hingga 6 baris teratas
                const limitedRows = rows.slice(0, 6);
                
                list.innerHTML = '';
                limitedRows.forEach(row => {
                    const col = row.split('","').map(c => c.replace(/"/g, ''));
                    if(col.length >= 2) {
                        list.innerHTML += `
                            <div class="card">
                                <h3 style="margin-bottom:5px">${col[0]}</h3>
                                <p style="font-size:0.9rem; color:#444">${col[1]}</p>
                                <small style="color:gray">Update: ${col[2] || '-'}</small>
                            </div>`;
                    }
                });
            } catch (e) { 
                list.innerHTML = "<p>Gagal memuat data /now.</p>"; 
            }
        }

        loadProfile();
        loadBlog();
        loadNow();
    </script>
</body>
</html>
