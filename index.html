<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Romli - Personal Site</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* CSS untuk Foto Profil */
        .profile-pic-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .profile-pic {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #eee;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        /* Style Tombol Lihat Journal */
        .btn-journal {
            display: inline-block;
            margin-top: 25px;
            padding: 12px 25px;
            text-decoration: none;
            color: #333;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: 0.3s;
        }
        .btn-journal:hover {
            background-color: #f9f9f9;
            border-color: #bbb;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="profile-pic-container">
                <img src="profile.jpg" alt="Romli" class="profile-pic" onerror="this.src='https://via.placeholder.com/150'">
            </div>
            <h1>Romli</h1>
            <p class="subtitle">Digital Enthusiast & Strategist</p>
        </header>

        <section id="about">
            <h2>Tentang</h2>
            <div id="profile-content" class="card">Memuat profil...</div>
        </section>

        <section id="now">
            <h2>/now</h2>
            <div id="portfolio-list" class="grid">
                <p>Memuat status terbaru...</p>
            </div>
        </section>

        <section id="journal">
            <h2>Journal</h2>
            <div id="blog-list" class="grid">
                <p>Memuat tulisan...</p>
            </div>
            
            <div style="text-align:center;">
                <a href="journal.html" class="btn-journal">Lihat Journal →</a>
            </div>
        </section>
    </div>

    <footer>
        <p>&copy; 2026 Romli Site • Managed via Mobile</p>
    </footer>

    <script>
        const CONFIG = {
            user: "romli", 
            repo: "romli-site",
            sheetUrl: "https://docs.google.com/spreadsheets/d/1E2sWBE7Vh38L-Y4c2Q0UJTMExFpu2CKkWht21LcRKdk/gviz/tq?tqx=out:csv"
        };

        async function loadProfile() {
            try {
                const res = await fetch(`https://raw.githubusercontent.com/${CONFIG.user}/${CONFIG.repo}/main/profile.md`);
                const text = await res.text();
                document.getElementById('profile-content').innerHTML = marked.parse(text);
            } catch (e) { 
                document.getElementById('profile-content').innerHTML = "Gagal memuat profil.";
            }
        }

        async function loadBlog() {
            const list = document.getElementById('blog-list');
            try {
                const res = await fetch(`https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/blog`);
                const files = await res.json();
                
                // Filter file .md dan ambil 3 terbaru saja
                const mdFiles = files.filter(f => f.name.endsWith('.md')).reverse();
                const limitedFiles = mdFiles.slice(0, 3);
                
                list.innerHTML = '';
                if(limitedFiles.length === 0) {
                    list.innerHTML = "<p>Belum ada tulisan.</p>";
                    return;
                }

                limitedFiles.forEach(file => {
                    // Logika pengambilan kategori dari nama file
                    const parts = file.name.split('-');
                    const kategori = parts[3] || 'umum';
                    const judul = file.name.replace(/-/g, ' ').replace('.md', '').substring(11 + kategori.length + 1);
                    
                    list.innerHTML += `
                        <div class="card">
                            <small style="text-transform:uppercase; color:gray; font-size:0.7rem;">${kategori}</small>
                            <h3 style="margin:5px 0 10px 0">${judul}</h3>
                            <a href="post.html?file=${file.name}" style="text-decoration:none;color:black;font-weight:600;font-size:0.85rem;">Baca Tulisan →</a>
                        </div>`;
                });
            } catch (e) { 
                list.innerHTML = "<p>Belum ada tulisan blog.</p>"; 
            }
        }

        async function loadNow() {
            const list = document.getElementById('portfolio-list');
            try {
                const res = await fetch(CONFIG.sheetUrl);
                const data = await res.text();
                const rows = data.split('\n').slice(1); 
                
                // Ambil maksimal 6 baris teratas
                const limitedRows = rows.slice(0, 6);
                
                list.innerHTML = '';
                limitedRows.forEach(row => {
                    const col = row.split('","').map(c => c.replace(/"/g, ''));
                    if(col.length >= 2) {
                        list.innerHTML += `
                            <div class="card">
                                <h3 style="margin-bottom:5px">${col[0]}</h3>
                                <p style="font-size:0.9rem; color:#444">${col[1]}</p>
                                <small style="color:gray">Update: ${col[2] || '-'}</small>
                            </div>`;
                    }
                });
            } catch (e) { 
                list.innerHTML = "<p>Gagal memuat data /now.</p>"; 
            }
        }

        loadProfile();
        loadBlog();
        loadNow();
    </script>
</body>
</html>
